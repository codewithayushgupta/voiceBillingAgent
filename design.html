<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vaani AI Billing ‚Äî Vanilla</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* Extra small layout centered like your React app */
    body { background: #f9fafb; font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
    .app-wrap { max-width: 480px; margin: 0 auto; height: 100vh; display: flex; flex-direction: column; position: relative; overflow: hidden; }
    .pulse {
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
      0%,100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.45; transform: scale(0.95); }
    }
    /* small shadow for fixed bottom bar separation on small screens */
    .bottom-shadow { box-shadow: 0 -2px 8px rgba(0,0,0,0.05); }
    /* hide number input spinner for nicer UI */
    input[type=number]::-webkit-outer-spin-button, input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
  </style>
</head>
<body>
  <div class="app-wrap mx-auto">

    <!-- Header -->
    <header class="bg-white border-b border-gray-200 py-4 px-4 flex items-center gap-3 shadow-sm">
      <div class="text-xl font-extrabold text-slate-800 flex items-center gap-2">
        <span class="text-2xl">üßæ</span>
        <span>Vaani AI Billing</span>
      </div>
      <div class="ml-auto text-sm text-gray-500">‡§∞‡§æ‡§ú‡•á‡§∂ ‡§∏‡•ç‡§ü‡•ã‡§∞</div>
    </header>

    <!-- Content -->
    <main id="mainContent" class="flex-1 overflow-y-auto bg-gray-50">
      <!-- dynamic content injected by JS -->
    </main>

    <!-- Fixed transcript & mic footer (floating above tab bar) -->
    <div id="transcriptFooter" class="fixed left-0 right-0 bottom-20 max-w-[480px] mx-auto z-40 bg-white border-t border-gray-200 shadow-lg">
      <div class="p-3">
        <div id="transcriptBox" class="bg-gray-50 rounded-xl p-3 min-h-[56px] italic text-sm text-gray-600">
          Press and hold mic to start billing...
        </div>

        <div id="listeningIndicator" class="mt-3 hidden flex items-center justify-center gap-2 text-red-500 text-sm">
          <div class="w-2.5 h-2.5 rounded-full bg-red-500 pulse"></div>
          Listening...
        </div>
      </div>

      <div class="flex items-center justify-between px-4 pb-4">
        <button id="clearBtn" class="flex items-center gap-2 px-3 py-2 rounded-xl border border-gray-200 font-semibold text-gray-600">
          <!-- trash emoji to keep it simple -->
          <span>üóëÔ∏è</span> Clear
        </button>

        <!-- Mic button (press & hold) -->
        <button id="micBtn" class="w-18 h-18 rounded-full text-white text-3xl flex items-center justify-center"
                style="width:72px; height:72px; background: linear-gradient(135deg,#10b981,#059669); box-shadow: 0 8px 24px rgba(79,70,229,0.12);">
          üé§
        </button>

        <button id="billBtn" class="flex items-center gap-2 px-3 py-2 rounded-xl border-2 border-indigo-600 text-indigo-600 font-semibold">
          üßæ Bill
        </button>
      </div>
    </div>

    <!-- Bottom Tab Bar -->
    <nav class="fixed bottom-0 left-0 right-0 max-w-[480px] mx-auto bg-white border-t border-gray-200 py-2 px-1 bottom-shadow z-50 flex justify-around">
      <button class="tabBtn flex-1 flex flex-col items-center gap-1 py-1 px-2 text-gray-400" data-tab="bills">
        <div class="text-xl">üè†</div>
        <span class="text-[11px] font-medium">Bills</span>
      </button>

      <button class="tabBtn flex-1 flex flex-col items-center gap-1 py-1 px-2 text-gray-400" data-tab="items">
        <div class="text-xl">üì¶</div>
        <span class="text-[11px] font-medium">Items</span>
      </button>

      <button class="tabBtn active flex-1 flex flex-col items-center gap-1 py-1 px-2 text-indigo-600" data-tab="invoice">
        <div class="text-xl">üéôÔ∏è</div>
        <span class="text-[11px] font-semibold">Voice</span>
        <div class="w-1.5 h-1.5 mt-1 rounded-full bg-indigo-600"></div>
      </button>

      <button class="tabBtn flex-1 flex flex-col items-center gap-1 py-1 px-2 text-gray-400" data-tab="reports">
        <div class="text-xl">üìä</div>
        <span class="text-[11px] font-medium">Reports</span>
      </button>

      <button class="tabBtn flex-1 flex flex-col items-center gap-1 py-1 px-2 text-gray-400" data-tab="profile">
        <div class="text-xl">üë§</div>
        <span class="text-[11px] font-medium">Profile</span>
      </button>
    </nav>

  </div>

  <script>
    /**********************************************************************
     * Vaani Billing - Vanilla JS state + UI
     * Replicates the behavior of the React component you provided.
     **********************************************************************/

    // ---------- State ----------
    const state = {
      activeTab: 'invoice',
      items: [
        { id: 1, name: '‡§ö‡§æ‡§µ‡§≤', qty: 5, price: 60, total: 300 },
        { id: 2, name: '‡§¶‡§æ‡§≤', qty: 2, price: 120, total: 240 },
        { id: 3, name: '‡§§‡•á‡§≤', qty: 1, price: 180, total: 180 }
      ],
      listening: false,
      isPressing: false,
      transcript: '',
      editingId: null,
      editForm: { name: '', qty: 0, price: 0 }
    };

    // ---------- Helpers ----------
    const q = s => document.querySelector(s);
    const qa = s => Array.from(document.querySelectorAll(s));
    const main = q('#mainContent');
    const transcriptBox = q('#transcriptBox');
    const listeningIndicator = q('#listeningIndicator');
    const micBtn = q('#micBtn');
    const clearBtn = q('#clearBtn');
    const billBtn = q('#billBtn');
    const tabBtns = qa('.tabBtn');

    function calcTotal() {
      return state.items.reduce((sum, it) => sum + (Number(it.total) || 0), 0);
    }

    // Re-render UI depending on activeTab
    function render() {
      // Update transcript & listening UI
      transcriptBox.textContent = state.transcript || 'Press and hold mic to start billing...';
      listeningIndicator.classList.toggle('hidden', !state.listening);
      // mic button style
      if (state.isPressing || state.listening) {
        micBtn.style.background = 'linear-gradient(135deg,#ef4444,#dc2626)';
        micBtn.textContent = '‚è∫Ô∏è';
        micBtn.style.transform = state.isPressing ? 'scale(0.95)' : 'scale(1)';
      } else {
        micBtn.style.background = 'linear-gradient(135deg,#10b981,#059669)';
        micBtn.textContent = 'üé§';
        micBtn.style.transform = 'scale(1)';
      }

      // Tab active state on nav
      tabBtns.forEach(btn => {
        const t = btn.dataset.tab;
        if (t === state.activeTab) {
          btn.classList.add('text-indigo-600');
          btn.classList.remove('text-gray-400');
          btn.querySelector('span').classList.add('font-semibold');
        } else {
          btn.classList.add('text-gray-400');
          btn.classList.remove('text-indigo-600');
          btn.querySelector('span').classList.remove('font-semibold');
        }
      });

      // Render main content
      switch (state.activeTab) {
        case 'bills': renderBills(); break;
        case 'items': renderItems(); break;
        case 'invoice': renderInvoice(); break;
        case 'reports': renderReports(); break;
        case 'profile': renderProfile(); break;
        default: renderInvoice();
      }
    }

    // ---------- Tab renders ----------
    function renderBills() {
      main.innerHTML = `
        <section class="p-4">
          <h2 class="text-lg font-semibold mb-3">Generated Bills</h2>
          <div class="flex flex-col gap-3">
            ${[1,2,3].map(i => `
              <article class="bg-white p-4 rounded-xl shadow-sm">
                <h3 class="font-semibold mb-1">Bill #${String(i).padStart(3,'0')}</h3>
                <p class="text-sm text-gray-500">${3+i} items ‚Ä¢ ‚Çπ${(420 + i*100).toFixed(2)} ‚Ä¢ ${i} Mar 2025</p>
              </article>
            `).join('')}
          </div>
        </section>
      `;
    }

    function renderItems() {
      main.innerHTML = `
        <section class="p-4">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-semibold">Inventory</h2>
            <button id="addNewItem" class="px-3 py-2 bg-indigo-600 text-white rounded-lg font-semibold">+ Add</button>
          </div>
          <div class="flex flex-col gap-3">
            ${state.items.map(it => `
              <article class="bg-white p-4 rounded-xl shadow-sm">
                <h3 class="font-semibold text-slate-800">${escapeHtml(it.name)}</h3>
                <p class="text-sm text-gray-500">Qty: ${it.qty} ‚Ä¢ Price: ‚Çπ${it.price} ‚Ä¢ Total: ‚Çπ${it.total}</p>
              </article>
            `).join('')}
          </div>
        </section>
      `;

      // hook add
      const addBtn = q('#addNewItem');
      addBtn.addEventListener('click', () => {
        addItem();
      });
    }

    function renderReports() {
      const total = calcTotal();
      main.innerHTML = `
        <section class="p-4">
          <h2 class="text-lg font-semibold mb-3">Sales Reports</h2>
          <div class="bg-white rounded-xl p-6 shadow-sm text-center">
            <div class="mb-6">
              <div class="text-3xl font-extrabold text-indigo-600">‚Çπ${total.toFixed(2)}</div>
              <div class="text-gray-500 mt-1">Total Sales Today</div>
            </div>
            <div class="grid grid-cols-2 gap-4 text-left">
              <div>
                <div class="text-sm text-gray-500">Total Items</div>
                <div class="text-xl font-semibold">${state.items.length}</div>
              </div>
              <div>
                <div class="text-sm text-gray-500">Avg. Bill</div>
                <div class="text-xl font-semibold">‚Çπ${state.items.length > 0 ? Math.round(total / state.items.length) : 0}</div>
              </div>
            </div>
          </div>
        </section>
      `;
    }

    function renderProfile() {
      main.innerHTML = `
        <section class="p-4">
          <h2 class="text-lg font-semibold mb-3">Profile</h2>
          <div class="bg-white rounded-xl p-6 shadow-sm">
            <div class="text-center mb-6">
              <div class="w-20 h-20 rounded-full mx-auto mb-3 flex items-center justify-center text-3xl font-bold text-white" style="background:linear-gradient(135deg,#4f46e5,#7c3aed)">
                üè™
              </div>
              <h3 class="text-lg font-semibold">‡§∞‡§æ‡§ú‡•á‡§∂ ‡§∏‡•ç‡§ü‡•ã‡§∞</h3>
              <div class="text-gray-500">Owner: ‡§∞‡§æ‡§ú‡•á‡§∂ ‡§ï‡•Å‡§Æ‡§æ‡§∞</div>
            </div>

            <div class="flex flex-col gap-3">
              <div class="p-3 bg-gray-50 rounded-lg">
                <div class="text-sm text-gray-500">Phone</div>
                <div class="font-semibold">+91 98765 43210</div>
              </div>
              <div class="p-3 bg-gray-50 rounded-lg">
                <div class="text-sm text-gray-500">Address</div>
                <div class="font-semibold">Patna, Bihar</div>
              </div>
            </div>
          </div>
        </section>
      `;
    }

    function renderInvoice() {
      const total = calcTotal();
      main.innerHTML = `
        <section class="p-4 pb-32">
          <!-- top badge -->
          <div class="inline-block rounded-2xl px-4 py-2 mb-4 font-bold text-white" style="background:linear-gradient(135deg,#4f46e5,#7c3aed); box-shadow: 0 8px 16px rgba(79,70,229,0.12)">
            üì¶ ${state.items.length} Items ‚Ä¢ Total: ‚Çπ${total.toFixed(2)}
          </div>

          <!-- items table -->
          <div class="bg-white rounded-2xl overflow-hidden shadow-sm">
            <table class="w-full table-fixed">
              <thead class="bg-gray-50 border-b border-gray-200">
                <tr>
                  <th class="text-left p-4 font-semibold text-sm">Item</th>
                  <th class="text-center p-4 font-semibold text-sm w-20">Qty</th>
                  <th class="text-right p-4 font-semibold text-sm w-28">Price</th>
                  <th class="text-right p-4 font-semibold text-sm w-28">Total</th>
                  <th class="text-center p-4 font-semibold text-sm w-20">‚ö°</th>
                </tr>
              </thead>
              <tbody id="itemsBody">
                ${state.items.map((it, idx) => renderItemRow(it, idx)).join('')}
              </tbody>
            </table>
          </div>
        </section>
      `;

      // Attach listeners for delete/edit/save/cancel in invoice
      // Use event delegation on the table body
      const itemsBody = q('#itemsBody');
      itemsBody.addEventListener('click', invoiceTableClickHandler);
    }

    function renderItemRow(it, idx) {
      if (state.editingId === it.id) {
        // editing row spanning full width
        return `
          <tr class="bg-white border-b">
            <td colspan="5" class="p-4">
              <div class="flex flex-col gap-3">
                <input data-edit="name" class="border border-gray-200 rounded-lg p-2 w-full" value="${escapeHtml(it.name)}" placeholder="Item name" />
                <div class="flex gap-3">
                  <input data-edit="qty" type="number" class="border border-gray-200 rounded-lg p-2 flex-1" value="${Number(state.editForm.qty)}" placeholder="Qty" />
                  <input data-edit="price" type="number" class="border border-gray-200 rounded-lg p-2 flex-1" value="${Number(state.editForm.price)}" placeholder="Price" />
                </div>
                <div class="flex gap-2">
                  <button data-action="save" class="flex-1 bg-emerald-500 text-white py-2 rounded-lg font-semibold">Save ‚úÖ</button>
                  <button data-action="cancel" class="flex-1 bg-gray-500 text-white py-2 rounded-lg font-semibold">Cancel ‚úñ</button>
                </div>
              </div>
            </td>
          </tr>
        `;
      } else {
        return `
          <tr class="${idx % 2 === 0 ? 'bg-white' : 'bg-gray-50'} border-b">
            <td class="p-4 font-semibold text-slate-800">${escapeHtml(it.name)}</td>
            <td class="p-4 text-center">${it.qty}</td>
            <td class="p-4 text-right">‚Çπ${it.price}</td>
            <td class="p-4 text-right font-semibold text-indigo-600">‚Çπ${it.total}</td>
            <td class="p-4 text-center">
              <div class="flex items-center justify-center gap-2">
                <button data-action="edit" data-id="${it.id}" class="text-sm text-indigo-600 font-semibold">‚úèÔ∏è</button>
                <button data-action="delete" data-id="${it.id}" class="text-sm text-red-500 font-semibold">üóëÔ∏è</button>
              </div>
            </td>
          </tr>
        `;
      }
    }

    // ---------- Event handlers ----------
    // bottom nav
    qa('.tabBtn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        state.activeTab = btn.dataset.tab;
        // cancel edit on tab change
        state.editingId = null;
        render();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    });

    // mic press/release handlers (mouse + touch + pointer)
    function handleMicPress(e) {
      e.preventDefault();
      state.isPressing = true;
      state.listening = true;
      state.transcript = 'Listening...';
      render();
    }
    function handleMicRelease(e) {
      // If release happened while not pressing, ignore
      state.isPressing = false;
      state.listening = false;
      state.transcript = 'Press and hold mic to speak...';
      render();
    }

    // Add item (used in Items tab and can be reused)
    function addItem() {
      const newItem = {
        id: Date.now(),
        name: '‡§®‡§Ø‡§æ ‡§Ü‡§á‡§ü‡§Æ',
        qty: 1,
        price: 100,
        total: 100
      };
      state.items = [...state.items, newItem];
      render();
      // Scroll to bottom to show new item (invoice tab)
      if (state.activeTab !== 'invoice') {
        state.activeTab = 'invoice';
      }
      render();
      setTimeout(()=> window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' }), 200);
    }

    // delete item by id
    function deleteItem(id) {
      state.items = state.items.filter(it => it.id !== id);
      // if editing that id, cancel editing
      if (state.editingId === id) state.editingId = null;
      render();
    }

    // start editing item
    function startEdit(itemId) {
      const it = state.items.find(i => i.id === itemId);
      if (!it) return;
      state.editingId = itemId;
      state.editForm = { name: it.name, qty: it.qty, price: it.price };
      render();
      // focus name input after render
      setTimeout(() => {
        const inputName = q('input[data-edit="name"]');
        if (inputName) inputName.focus();
      }, 40);
    }

    // save edit
    function saveEdit(itemId) {
      // read current inputs from DOM
      const nameEl = q('input[data-edit="name"]');
      const qtyEl = q('input[data-edit="qty"]');
      const priceEl = q('input[data-edit="price"]');
      const newName = nameEl ? nameEl.value.trim() : state.editForm.name;
      const newQty = qtyEl ? Number(qtyEl.value || 0) : Number(state.editForm.qty);
      const newPrice = priceEl ? Number(priceEl.value || 0) : Number(state.editForm.price);

      state.items = state.items.map(it => it.id === itemId ? {
        ...it,
        name: newName || '‡§®‡§Ø‡§æ ‡§Ü‡§á‡§ü‡§Æ',
        qty: newQty,
        price: newPrice,
        total: newQty * newPrice
      } : it);

      state.editingId = null;
      render();
    }

    // cancel edit
    function cancelEdit() {
      state.editingId = null;
      render();
    }

    // invoice table click handler (delegation)
    function invoiceTableClickHandler(e) {
      const actionBtn = e.target.closest('button') || e.target.closest('[data-action]');
      const td = e.target.closest('[data-action], button[data-action], [data-id]');
      // We'll inspect dataset or attributes up the tree
      const el = e.target.closest('[data-action]') || e.target.closest('[data-id]') || e.target;
      // simpler: check if clicked element or its parent has data-action or data-id
      let actionEl = e.target;
      while (actionEl && actionEl !== e.currentTarget) {
        const action = actionEl.getAttribute('data-action');
        const id = actionEl.getAttribute('data-id');
        if (action) {
          const numericId = id ? Number(id) : null;
          if (action === 'delete') { if (numericId) deleteItem(numericId); }
          else if (action === 'edit') { if (numericId) startEdit(numericId); }
          else if (action === 'save') {
            // find current editing id from state
            if (state.editingId) saveEdit(state.editingId);
          }
          else if (action === 'cancel') { cancelEdit(); }
          return;
        }
        actionEl = actionEl.parentElement;
      }
    }

    // clear all
    function clearAll() {
      if (confirm('‡§∏‡§≠‡•Ä ‡§Ü‡§á‡§ü‡§Æ ‡§π‡§ü‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?')) {
        state.items = [];
        state.editingId = null;
        render();
      }
    }

    // generate PDF (placeholder)
    function generatePDF() {
      alert('‡§¨‡§ø‡§≤ ‡§ú‡•á‡§®‡§∞‡•á‡§ü ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...');
    }

    // escape HTML helper
    function escapeHtml(str) {
      return String(str)
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#039;');
    }

    // ---------- wiring up global listeners ----------
    // mic pointer events (support pointer, mouse, touch)
    micBtn.addEventListener('pointerdown', handleMicPress);
    micBtn.addEventListener('mousedown', handleMicPress);
    micBtn.addEventListener('touchstart', handleMicPress, { passive: false });

    // release/end
    // We attach release handlers to window to catch release even if pointer leaves the button
    function onReleaseAny(e) {
      if (!state.isPressing) return;
      state.isPressing = false;
      state.listening = false;
      state.transcript = 'Press and hold mic to speak...';
      render();
    }
    window.addEventListener('pointerup', onReleaseAny);
    window.addEventListener('mouseup', onReleaseAny);
    window.addEventListener('touchend', onReleaseAny);

    // For safety, when leaving the mic by pointercancel
    window.addEventListener('pointercancel', onReleaseAny);
    window.addEventListener('touchcancel', onReleaseAny);

    // clear, bill, add item
    clearBtn.addEventListener('click', clearAll);
    billBtn.addEventListener('click', generatePDF);

    // Add item via double-click mic (shortcut)
    micBtn.addEventListener('dblclick', (e) => {
      addItem();
    });

    // "Add" in Items tab is wired inside renderItems when created

    // ---------- Initial render ----------
    // Set initial transcript
    state.transcript = 'Press and hold mic to speak...';
    render();

    // Expose minimal keyboard accessibility: space on mic focuses press
    micBtn.addEventListener('keydown', (e) => {
      if (e.key === ' ' || e.key === 'Enter') {
        e.preventDefault();
        handleMicPress(e);
      }
    });
    micBtn.addEventListener('keyup', (e) => {
      if (e.key === ' ' || e.key === 'Enter') {
        onReleaseAny();
      }
    });

    // ---------- Notes ----------
    // - This version intentionally does not include live speech-to-text.
    // - Press-and-hold toggles the listening UI (visual). Double-click mic adds an item quickly.
    // - Edit flow is inline and persists to state.items.
    // - You can extend generatePDF() to actually create a PDF using jsPDF or similar.

  </script>
</body>
</html>
